import{c as R}from"./clsx-B-dksMZM.js";import{r as h,e as a}from"./index-DASCADcX.js";import{a as k,L as G,E as Z}from"./Label-C-_BY61p.js";import{o as q}from"./omit-B7stZg_p.js";import{u as J}from"./useId-BiFzyKmP.js";import{G as K}from"./index-CL4jvrHg.js";import{u as P}from"./useClientLayoutEffect-Dt_TuINI.js";import{u as Q}from"./create-context-Bo0OP0Ib.js";import{c as X}from"./Button-CiEWTRO4.js";import{b as Y}from"./ReadOnlyIcon-DezK7_1v.js";import{u as ee}from"./useFormField-BJl8SNDY.js";import{a as te}from"./Loader-DokcRViZ.js";function B(e,o=166,n=!1){let t;function r(...c){const l=()=>{t=void 0,e.apply(this,c)};!t&&n&&l(),clearTimeout(t),t=setTimeout(l,o)}return r.clear=()=>{clearTimeout(t)},r}var re=function(e,o){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)o.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};const W=(e,o,n)=>{const{outerHeightStyle:t,overflow:r}=o;return n.current<20&&(t>0&&Math.abs((e.outerHeightStyle||0)-t)>1||e.overflow!==r)?(n.current+=1,o):e},$=e=>((e==null?void 0:e.ownerDocument)||document).defaultView||window;function j(e){return parseInt(e,10)||0}const ne=h.forwardRef((e,o)=>{var n,t,{className:r,onChange:c,maxRows:l,minRows:p=1,autoScrollbar:z,style:i,value:L}=e,H=re(e,["className","onChange","maxRows","minRows","autoScrollbar","style","value"]);const{current:F}=h.useRef(L!=null),m=h.useRef(null),N=Q(m,o),M=h.useRef(null),y=h.useRef(0),[O,T]=h.useState({outerHeightStyle:0}),g=a.useCallback(()=>{const u=m.current,f=$(u).getComputedStyle(u);if(f.width==="0px")return{outerHeightStyle:0};const d=M.current;d.style.width=f.width,d.value=u.value||H.placeholder||"x",d.value.slice(-1)===`
`&&(d.value+=" ");const v=f.boxSizing,b=j(f.paddingBottom)+j(f.paddingTop),S=j(f.borderBottomWidth)+j(f.borderTopWidth),E=d.scrollHeight-b;d.value="x";const I=d.scrollHeight-b;let x=E;p&&(x=Math.max(Number(p)*I,x)),l&&(x=Math.min(Number(l)*I,x)),x=Math.max(x,I);const U=x+(v==="border-box"?b+S:0),A=Math.abs(x-E)<=1;return{outerHeightStyle:U,overflow:A}},[l,p,H.placeholder]),s=()=>{const u=g();D(u)||T(w=>W(w,u,y))};P(()=>{const u=()=>{const b=g();D(b)||K.flushSync(()=>{T(S=>W(S,b,y))})},w=B(()=>{var b,S,E;if(y.current=0,!((b=m.current)===null||b===void 0)&&b.style.height||!((S=m.current)===null||S===void 0)&&S.style.width){((E=m.current)===null||E===void 0?void 0:E.style.overflow)==="hidden"&&T(I=>Object.assign(Object.assign({},I),{overflow:!1}));return}u()},166,!0),f=m.current,d=$(f);d.addEventListener("resize",w);let v;return typeof ResizeObserver<"u"&&(v=new ResizeObserver(w),v.observe(f)),()=>{w.clear(),d.removeEventListener("resize",w),v&&v.disconnect()}},[g]),P(()=>{s()}),h.useEffect(()=>{y.current=0},[L]);const _=u=>{y.current=0,F||s(),c&&c(u)},C=Object.assign({"--__ac-textarea-height":O.outerHeightStyle+"px","--__axc-textarea-height":O.outerHeightStyle+"px",overflow:O.overflow&&!z&&!(!((n=m.current)===null||n===void 0)&&n.style.height)&&!(!((t=m.current)===null||t===void 0)&&t.style.width)?"hidden":void 0},i);return a.createElement(a.Fragment,null,a.createElement("textarea",Object.assign({value:L,onChange:_,ref:N,rows:p,style:C},H,{className:r})),a.createElement("textarea",{"aria-hidden":!0,className:r,readOnly:!0,ref:M,tabIndex:-1,style:Object.assign({visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},i)}))});function D(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflow}const oe=({maxLengthId:e,maxLength:o,currentLength:n,size:t,i18n:r})=>{const c=te("Textarea",{charsLeft:r!=null&&r.counterLeft?`{chars} ${r.counterLeft}`:void 0,charsTooMany:r!=null&&r.counterTooMuch?`{chars} ${r.counterTooMuch}`:void 0}),l=o-n,[p,z]=h.useState(l);return h.useEffect(()=>{const i=B(()=>{z(l)},2e3);return i(),()=>{i.clear()}},[l]),a.createElement(a.Fragment,null,a.createElement("span",{id:e,className:"navds-sr-only"},c("maxLength",{maxLength:o})),l<20&&a.createElement("span",{role:"status",className:"navds-textarea__sr-counter navds-sr-only"},V(p,c)),a.createElement(k,{className:R("navds-textarea__counter",{"navds-textarea__counter--error":l<0}),size:t},V(l,c)))},V=(e,o)=>e<0?o("charsTooMany",{chars:Math.abs(e)}):o("charsLeft",{chars:e});var ae=function(e,o){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)o.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};const ge=h.forwardRef((e,o)=>{var n,t,r;const{inputProps:c,errorId:l,showErrorMsg:p,hasError:z,size:i,inputDescriptionId:L}=ee(e,"textarea"),{label:H,className:F,description:m,maxLength:N,hideLabel:M=!1,resize:y,UNSAFE_autoScrollbar:O,i18n:T,readOnly:g}=e,s=ae(e,["label","className","description","maxLength","hideLabel","resize","UNSAFE_autoScrollbar","i18n","readOnly"]),_=J(),C=N!==void 0&&N>0,[u,w]=h.useState((n=e==null?void 0:e.defaultValue)!==null&&n!==void 0?n:""),f=()=>{let v=s!=null&&s.minRows?s==null?void 0:s.minRows:3;return i==="small"&&(v=s!=null&&s.minRows?s==null?void 0:s.minRows:2),v},d=R(c["aria-describedby"],{[_??""]:C});return a.createElement("div",{className:R(F,"navds-form-field",`navds-form-field--${i}`,{"navds-form-field--disabled":!!c.disabled,"navds-form-field--readonly":g,"navds-textarea--readonly":g,"navds-textarea--error":z,"navds-textarea--autoscrollbar":O,[`navds-textarea--resize-${y===!0?"both":y}`]:y})},a.createElement(G,{htmlFor:c.id,size:i,className:R("navds-form-field__label",{"navds-sr-only":M})},g&&a.createElement(Y,null),H),!!m&&a.createElement(k,{className:R("navds-form-field__description",{"navds-sr-only":M}),id:L,size:i,as:"div"},m),a.createElement(ne,Object.assign({},q(s,["error","errorId","size"]),c,{onChange:X(e.onChange,e.value===void 0?v=>w(v.target.value):void 0),minRows:f(),autoScrollbar:O,ref:o,readOnly:g,className:R("navds-textarea__input","navds-body-short",`navds-body-short--${i??"medium"}`)},d?{"aria-describedby":d}:{})),C&&!g&&!c.disabled&&a.createElement(oe,{maxLengthId:_,maxLength:N,currentLength:(r=(t=e.value)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:u.length,size:i,i18n:T}),a.createElement("div",{className:"navds-form-field__error",id:l,"aria-relevant":"additions removals","aria-live":"polite"},p&&a.createElement(Z,{size:i,showIcon:!0},e.error)))});export{ge as T,B as d};
