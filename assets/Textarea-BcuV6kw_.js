import{b as Z,u as V,c as q}from"./Theme-CaMvzsUv.js";import{r as b,e as a}from"./index-DASCADcX.js";import{a as B,L as G,E as J}from"./Label-ymrTdXLG.js";import{o as K}from"./omit-B7stZg_p.js";import{u as Q}from"./useId-BiFzyKmP.js";import{h as X}from"./index-CRSK7kgn.js";import{u as F}from"./useClientLayoutEffect-Dt_TuINI.js";import{c as Y}from"./Button-Dgzkd3lk.js";import{a as ee}from"./ReadOnlyIcon-DdHBAqwe.js";import{u as te}from"./useFormField-C_Behg-2.js";import{a as re}from"./Loader--92hiQI0.js";function U(e,o=166,n=!1){let t;function r(...i){const f=()=>{t=void 0,e.apply(this,i)};!t&&n&&f(),clearTimeout(t),t=setTimeout(f,o)}return r.clear=()=>{clearTimeout(t)},r}var ne=function(e,o){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)o.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};const P=(e,o,n)=>{const{outerHeightStyle:t,overflow:r}=o;return n.current<20&&(t>0&&Math.abs((e.outerHeightStyle||0)-t)>1||e.overflow!==r)?(n.current+=1,o):e},W=e=>((e==null?void 0:e.ownerDocument)||document).defaultView||window;function I(e){return parseInt(e,10)||0}const oe=b.forwardRef((e,o)=>{var n,t,{className:r,onChange:i,maxRows:f,minRows:d=1,autoScrollbar:L,style:c,value:x}=e,H=ne(e,["className","onChange","maxRows","minRows","autoScrollbar","style","value"]);const{current:j}=b.useRef(x!=null),v=b.useRef(null),N=Z(v,o),M=b.useRef(null),y=b.useRef(0),[E,T]=b.useState({outerHeightStyle:0}),g=a.useCallback(()=>{const u=v.current,m=W(u).getComputedStyle(u);if(m.width==="0px")return{outerHeightStyle:0};const h=M.current;h.style.width=m.width,h.value=u.value||H.placeholder||"x",h.value.slice(-1)===`
`&&(h.value+=" ");const p=m.boxSizing,l=I(m.paddingBottom)+I(m.paddingTop),_=I(m.borderBottomWidth)+I(m.borderTopWidth),z=h.scrollHeight-l;h.value="x";const C=h.scrollHeight-l;let S=z;d&&(S=Math.max(Number(d)*C,S)),f&&(S=Math.min(Number(f)*C,S)),S=Math.max(S,C);const k=S+(p==="border-box"?l+_:0),A=Math.abs(S-z)<=1;return{outerHeightStyle:k,overflow:A}},[f,d,H.placeholder]),s=()=>{const u=g();$(u)||T(w=>P(w,u,y))};F(()=>{const u=()=>{const l=g();$(l)||X.flushSync(()=>{T(_=>P(_,l,y))})},w=U(()=>{var l,_,z;if(y.current=0,!((l=v.current)===null||l===void 0)&&l.style.height||!((_=v.current)===null||_===void 0)&&_.style.width){((z=v.current)===null||z===void 0?void 0:z.style.overflow)==="hidden"&&T(C=>Object.assign(Object.assign({},C),{overflow:!1}));return}u()},166,!0),m=v.current,h=W(m);h.addEventListener("resize",w);let p;return typeof ResizeObserver<"u"&&(p=new ResizeObserver(w),p.observe(m)),()=>{w.clear(),h.removeEventListener("resize",w),p&&p.disconnect()}},[g]),F(()=>{s()}),b.useEffect(()=>{y.current=0},[x]);const O=u=>{y.current=0,j||s(),i&&i(u)},R=Object.assign({"--__ac-textarea-height":E.outerHeightStyle+"px","--__axc-textarea-height":E.outerHeightStyle+"px",overflow:E.overflow&&!L&&!(!((n=v.current)===null||n===void 0)&&n.style.height)&&!(!((t=v.current)===null||t===void 0)&&t.style.width)?"hidden":void 0},c);return a.createElement(a.Fragment,null,a.createElement("textarea",Object.assign({value:x,onChange:O,ref:N,rows:d,style:R},H,{className:r})),a.createElement("textarea",{"aria-hidden":!0,className:r,readOnly:!0,ref:M,tabIndex:-1,style:Object.assign({visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},c)}))});function $(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflow}const ae=({maxLengthId:e,maxLength:o,currentLength:n,size:t,i18n:r})=>{const{cn:i}=V(),f=re("Textarea",{charsLeft:r!=null&&r.counterLeft?`{chars} ${r.counterLeft}`:void 0,charsTooMany:r!=null&&r.counterTooMuch?`{chars} ${r.counterTooMuch}`:void 0}),d=o-n,[L,c]=b.useState(d);return b.useEffect(()=>{const x=U(()=>{c(d)},2e3);return x(),()=>{x.clear()}},[d]),a.createElement(a.Fragment,null,a.createElement("span",{id:e,className:i("navds-sr-only")},f("maxLength",{maxLength:o})),d<20&&a.createElement("span",{role:"status",className:i("navds-textarea__sr-counter navds-sr-only")},D(L,f)),a.createElement(B,{className:i("navds-textarea__counter",{"navds-textarea__counter--error":d<0}),size:t},D(d,f)))},D=(e,o)=>e<0?o("charsTooMany",{chars:Math.abs(e)}):o("charsLeft",{chars:e});var se=function(e,o){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)o.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};const ge=b.forwardRef((e,o)=>{var n,t,r;const{inputProps:i,errorId:f,showErrorMsg:d,hasError:L,size:c,inputDescriptionId:x}=te(e,"textarea"),{label:H,className:j,description:v,maxLength:N,hideLabel:M=!1,resize:y,UNSAFE_autoScrollbar:E,i18n:T,readOnly:g}=e,s=se(e,["label","className","description","maxLength","hideLabel","resize","UNSAFE_autoScrollbar","i18n","readOnly"]),{cn:O}=V(),R=Q(),u=N!==void 0&&N>0,[w,m]=b.useState((n=e==null?void 0:e.defaultValue)!==null&&n!==void 0?n:""),h=()=>{let l=s!=null&&s.minRows?s==null?void 0:s.minRows:3;return c==="small"&&(l=s!=null&&s.minRows?s==null?void 0:s.minRows:2),l},p=q(i["aria-describedby"],{[R??""]:u});return a.createElement("div",{className:O(j,"navds-form-field",`navds-form-field--${c}`,{"navds-form-field--disabled":!!i.disabled,"navds-form-field--readonly":g,"navds-textarea--readonly":g,"navds-textarea--error":L,"navds-textarea--autoscrollbar":E,[`navds-textarea--resize-${y===!0?"both":y}`]:y})},a.createElement(G,{htmlFor:i.id,size:c,className:O("navds-form-field__label",{"navds-sr-only":M})},g&&a.createElement(ee,null),H),!!v&&a.createElement(B,{className:O("navds-form-field__description",{"navds-sr-only":M}),id:x,size:c,as:"div"},v),a.createElement(oe,Object.assign({},K(s,["error","errorId","size"]),i,{onChange:Y(e.onChange,e.value===void 0?l=>m(l.target.value):void 0),minRows:h(),autoScrollbar:E,ref:o,readOnly:g,className:O("navds-textarea__input","navds-body-short",`navds-body-short--${c??"medium"}`)},p?{"aria-describedby":p}:{})),u&&!g&&!i.disabled&&a.createElement(ae,{maxLengthId:R,maxLength:N,currentLength:(r=(t=e.value)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:w.length,size:c,i18n:T}),a.createElement("div",{className:O("navds-form-field__error"),id:f,"aria-relevant":"additions removals","aria-live":"polite"},d&&a.createElement(J,{size:c,showIcon:!0},e.error)))});export{ge as T,U as d};
