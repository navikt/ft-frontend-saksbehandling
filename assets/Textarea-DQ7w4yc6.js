import{c as R}from"./clsx-B-dksMZM.js";import{r as b,R as o}from"./index-B5OHeJSP.js";import{a as B,L as Z,E as q}from"./Label-ZYbyet41.js";import{o as G}from"./omit-B7stZg_p.js";import{u as J}from"./useId-e75EoDiw.js";import{M as K}from"./index-sT6466e8.js";import{u as P}from"./useClientLayoutEffect-DnVV5Q77.js";import{u as Q}from"./create-context-BlrHNsQj.js";import{c as X}from"./Button-C4dKKha_.js";import{b as Y}from"./ReadOnlyIcon-3mCRcvzc.js";import{u as ee}from"./useFormField-BKpVC0Pg.js";import{a as te}from"./Loader-CoAqN6Lw.js";function U(e,a=166,r=!1){let t;function n(...d){const l=()=>{t=void 0,e.apply(this,d)};!t&&r&&l(),clearTimeout(t),t=setTimeout(l,a)}return n.clear=()=>{clearTimeout(t)},n}var ne=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(e);n<t.length;n++)a.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(r[t[n]]=e[t[n]]);return r};const W=(e,a,r)=>{const{outerHeightStyle:t,overflow:n}=a;return r.current<20&&(t>0&&Math.abs((e.outerHeightStyle||0)-t)>1||e.overflow!==n)?(r.current+=1,a):e},$=e=>((e==null?void 0:e.ownerDocument)||document).defaultView||window;function j(e){return parseInt(e,10)||0}const re=b.forwardRef((e,a)=>{var r,t,{className:n,onChange:d,maxRows:l,minRows:p=1,autoScrollbar:z,style:i,value:L}=e,M=ne(e,["className","onChange","maxRows","minRows","autoScrollbar","style","value"]);const{current:F}=b.useRef(L!=null),m=b.useRef(null),H=Q(m,a),N=b.useRef(null),g=b.useRef(0),[O,T]=b.useState({outerHeightStyle:0}),v=o.useCallback(()=>{const c=m.current,f=$(c).getComputedStyle(c);if(f.width==="0px")return{outerHeightStyle:0};const u=N.current;u.style.width=f.width,u.value=c.value||M.placeholder||"x",u.value.slice(-1)===`
`&&(u.value+=" ");const h=f.boxSizing,y=j(f.paddingBottom)+j(f.paddingTop),S=j(f.borderBottomWidth)+j(f.borderTopWidth),E=u.scrollHeight-y;u.value="x";const I=u.scrollHeight-y;let x=E;p&&(x=Math.max(Number(p)*I,x)),l&&(x=Math.min(Number(l)*I,x)),x=Math.max(x,I);const k=x+(h==="border-box"?y+S:0),A=Math.abs(x-E)<=1;return{outerHeightStyle:k,overflow:A}},[l,p,M.placeholder]),s=()=>{const c=v();D(c)||T(w=>W(w,c,g))};P(()=>{const c=()=>{const y=v();D(y)||K.flushSync(()=>{T(S=>W(S,y,g))})},w=U(()=>{var y,S,E;if(g.current=0,!((y=m.current)===null||y===void 0)&&y.style.height||!((S=m.current)===null||S===void 0)&&S.style.width){((E=m.current)===null||E===void 0?void 0:E.style.overflow)==="hidden"&&T(I=>Object.assign(Object.assign({},I),{overflow:!1}));return}c()},166,!0),f=m.current,u=$(f);u.addEventListener("resize",w);let h;return typeof ResizeObserver<"u"&&(h=new ResizeObserver(w),h.observe(f)),()=>{w.clear(),u.removeEventListener("resize",w),h&&h.disconnect()}},[v]),P(()=>{s()}),b.useEffect(()=>{g.current=0},[L]);const _=c=>{g.current=0,F||s(),d&&d(c)},C=Object.assign({"--__ac-textarea-height":O.outerHeightStyle+"px","--__axc-textarea-height":O.outerHeightStyle+"px",overflow:O.overflow&&!z&&!(!((r=m.current)===null||r===void 0)&&r.style.height)&&!(!((t=m.current)===null||t===void 0)&&t.style.width)?"hidden":void 0},i);return o.createElement(o.Fragment,null,o.createElement("textarea",Object.assign({value:L,onChange:_,ref:H,rows:p,style:C},M,{className:n})),o.createElement("textarea",{"aria-hidden":!0,className:n,readOnly:!0,ref:N,tabIndex:-1,style:Object.assign({visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},i)}))});function D(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflow}const ae=({maxLengthId:e,maxLength:a,currentLength:r,size:t,i18n:n})=>{const d=te("Textarea",{charsLeft:n!=null&&n.counterLeft?`{chars} ${n.counterLeft}`:void 0,charsTooMany:n!=null&&n.counterTooMuch?`{chars} ${n.counterTooMuch}`:void 0}),l=a-r,[p,z]=b.useState(l);return b.useEffect(()=>{const i=U(()=>{z(l)},2e3);return i(),()=>{i.clear()}},[l]),o.createElement(o.Fragment,null,o.createElement("span",{id:e,className:"navds-sr-only"},d("maxLength",{maxLength:a})),l<20&&o.createElement("span",{role:"status",className:"navds-textarea__sr-counter navds-sr-only"},V(p,d)),o.createElement(B,{className:R("navds-textarea__counter",{"navds-textarea__counter--error":l<0}),size:t},V(l,d)))},V=(e,a)=>e<0?a("charsTooMany",{chars:Math.abs(e)}):a("charsLeft",{chars:e});var oe=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(e);n<t.length;n++)a.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(r[t[n]]=e[t[n]]);return r};const ve=b.forwardRef((e,a)=>{var r,t,n;const{inputProps:d,errorId:l,showErrorMsg:p,hasError:z,size:i,inputDescriptionId:L}=ee(e,"textarea"),{label:M,className:F,description:m,maxLength:H,hideLabel:N=!1,resize:g,UNSAFE_autoScrollbar:O,i18n:T,readOnly:v}=e,s=oe(e,["label","className","description","maxLength","hideLabel","resize","UNSAFE_autoScrollbar","i18n","readOnly"]),_=J(),C=H!==void 0&&H>0,[c,w]=b.useState((r=e==null?void 0:e.defaultValue)!==null&&r!==void 0?r:""),f=()=>{let h=s!=null&&s.minRows?s==null?void 0:s.minRows:3;return i==="small"&&(h=s!=null&&s.minRows?s==null?void 0:s.minRows:2),h},u=R(d["aria-describedby"],{[_??""]:C});return o.createElement("div",{className:R(F,"navds-form-field",`navds-form-field--${i}`,{"navds-form-field--disabled":!!d.disabled,"navds-form-field--readonly":v,"navds-textarea--readonly":v,"navds-textarea--error":z,"navds-textarea--autoscrollbar":O,[`navds-textarea--resize-${g===!0?"both":g}`]:g})},o.createElement(Z,{htmlFor:d.id,size:i,className:R("navds-form-field__label",{"navds-sr-only":N})},v&&o.createElement(Y,null),M),!!m&&o.createElement(B,{className:R("navds-form-field__description",{"navds-sr-only":N}),id:L,size:i,as:"div"},m),o.createElement(re,Object.assign({},G(s,["error","errorId","size"]),d,{onChange:X(e.onChange,e.value===void 0?h=>w(h.target.value):void 0),minRows:f(),autoScrollbar:O,ref:a,readOnly:v,className:R("navds-textarea__input","navds-body-short",`navds-body-short--${i??"medium"}`)},u?{"aria-describedby":u}:{})),C&&!v&&!d.disabled&&o.createElement(ae,{maxLengthId:_,maxLength:H,currentLength:(n=(t=e.value)===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:c.length,size:i,i18n:T}),o.createElement("div",{className:"navds-form-field__error",id:l,"aria-relevant":"additions removals","aria-live":"polite"},p&&o.createElement(q,{size:i,showIcon:!0},e.error)))});export{ve as T,U as d};
